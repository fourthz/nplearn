<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Replacement Scores • nplearn</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Replacement Scores">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nplearn</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Bernoulli-Events.html">Bernoulli Events</a>
    </li>
    <li>
      <a href="../articles/binomdist.html">The Binomial Distribution</a>
    </li>
    <li>
      <a href="../articles/lsprop.html">Large-Sample Proportion Inference</a>
    </li>
    <li>
      <a href="../articles/OnePropExact.html">Exact Inference for a Single Proportion</a>
    </li>
    <li>
      <a href="../articles/randomization.html">Randomization Tests</a>
    </li>
    <li>
      <a href="../articles/ReplaceScores.html">Replacement Scores</a>
    </li>
    <li>
      <a href="../articles/signtest.html">The Sign Test</a>
    </li>
    <li>
      <a href="../articles/Workflow-Sample.html">Workflow Sample</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Replacement Scores</h1>
            
      
      
      <div class="hidden name"><code>ReplaceScores.Rmd</code></div>

    </div>

    
    
<p>We can conduct a matched-pair randomization test using only the sign of the differences, or we can also consider the magnitude of the difference. We can also replace the magnitude of the difference with another score that is related to this magnitude such that the order or sign of the differences are not changed. In this vignette we will discuss two possible replacement scores and examine some reasons why we might want to replace our original measures of the magnitude of a difference.</p>
<div id="required-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#required-packages" class="anchor"></a>Required packages</h3>
<p>The only package required for this vignette is nplearn.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(nplearn)</span></code></pre></div>
</div>
<div id="the-wilcoxon-signed-ranks-test" class="section level3">
<h3 class="hasAnchor">
<a href="#the-wilcoxon-signed-ranks-test" class="anchor"></a>The Wilcoxon signed ranks test</h3>
<p>A disadvantage of the Fisher-Pitman permutation test is that with even moderately-sized samples the number of possible permutations can grow large so that calculations are prohibitive. Let’s look at a little table showing the number of differences and the number of possible permutations associated with that number of differences.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>differences &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">50</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>num.perms &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">^</span>differences</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/noquote">noquote</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(differences, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(num.perms, <span class="dt">scientific =</span> <span class="ot">FALSE</span>)))</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;       differences                 </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;  [1,] 2                          4</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  [2,] 3                          8</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;  [3,] 4                         16</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;  [4,] 5                         32</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;  [5,] 6                         64</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;  [6,] 7                        128</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;  [7,] 8                        256</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;  [8,] 9                        512</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  [9,] 10                      1024</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; [10,] 11                      2048</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; [11,] 12                      4096</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; [12,] 13                      8192</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; [13,] 14                     16384</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; [14,] 15                     32768</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; [15,] 16                     65536</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; [16,] 17                    131072</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; [17,] 18                    262144</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; [18,] 19                    524288</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt; [19,] 20                   1048576</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; [20,] 21                   2097152</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; [21,] 22                   4194304</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt; [22,] 23                   8388608</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; [23,] 24                  16777216</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt; [24,] 25                  33554432</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt; [25,] 26                  67108864</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt; [26,] 27                 134217728</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt; [27,] 28                 268435456</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt; [28,] 29                 536870912</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">#&gt; [29,] 30                1073741824</span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">#&gt; [30,] 31                2147483648</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">#&gt; [31,] 32                4294967296</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">#&gt; [32,] 33                8589934592</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">#&gt; [33,] 34               17179869184</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; [34,] 35               34359738368</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt; [35,] 36               68719476736</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt; [36,] 37              137438953472</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt; [37,] 38              274877906944</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="co">#&gt; [38,] 39              549755813888</span></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="co">#&gt; [39,] 40             1099511627776</span></span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="co">#&gt; [40,] 41             2199023255552</span></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">#&gt; [41,] 42             4398046511104</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="co">#&gt; [42,] 43             8796093022208</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="co">#&gt; [43,] 44            17592186044416</span></span>
<span id="cb2-48"><a href="#cb2-48"></a><span class="co">#&gt; [44,] 45            35184372088832</span></span>
<span id="cb2-49"><a href="#cb2-49"></a><span class="co">#&gt; [45,] 46            70368744177664</span></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="co">#&gt; [46,] 47           140737488355328</span></span>
<span id="cb2-51"><a href="#cb2-51"></a><span class="co">#&gt; [47,] 48           281474976710656</span></span>
<span id="cb2-52"><a href="#cb2-52"></a><span class="co">#&gt; [48,] 49           562949953421312</span></span>
<span id="cb2-53"><a href="#cb2-53"></a><span class="co">#&gt; [49,] 50          1125899906842624</span></span></code></pre></div>
<p>Even with 50 difference scores we are into territory where calculation time might become a factor. I’m going to make the assumption that we can do the calculations for 10,000,000 permutations per second.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="dv">2</span><span class="op">^</span><span class="dv">50</span><span class="op">/</span><span class="dv">10000000</span><span class="op">/</span><span class="dv">60</span><span class="op">/</span><span class="dv">60</span><span class="op">/</span><span class="dv">24</span><span class="op">/</span><span class="dv">365</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">#&gt; [1] 3.570205</span></span></code></pre></div>
<p>Although 3.6 years might seem worth it for a study of high scientific value, we wouldn’t want to do this too often. If we repeat the study with a different set of numbers, we have to do the calculations all over again. (Can you imagine being about two years into your wait for the calculations to be done when you suddenly discover a typo in your data set?!)</p>
<p>One solution to the problem is to replace our original scores with ranks. Just as with the Fisher-Pitman permutation test, we order the scores (now we will use ranks instead of scores) without regard to the observed sign. Once we have done this, we can then look at all possible permutations of signs. We again use the sum of the positive scores (i.e., ranks) as our test statistic. As it is when we use scores, and using the same hypotheses, if the null hypothesis is true, we expect the sum of positive ranks to equal the sum of negative ranks, but with opposite signs. If the null hypothesis is not true, we would expect the sum of positive ranks to become either larger or smaller than we would expect.</p>
<p>Here are the data from the fertilizer study.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>fruit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">A =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">82</span>, <span class="dv">91</span>, <span class="dv">74</span>, <span class="dv">90</span>, <span class="dv">66</span>, <span class="dv">81</span>),</span>
<span id="cb4-2"><a href="#cb4-2"></a>                    <span class="dt">B =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">85</span>, <span class="dv">89</span>, <span class="dv">81</span>, <span class="dv">96</span>, <span class="dv">65</span>, <span class="dv">93</span>))</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(fruit<span class="op">$</span>A, fruit<span class="op">$</span>B)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; [1,]   82   85</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; [2,]   91   89</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; [3,]   74   81</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; [4,]   90   96</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; [5,]   66   65</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; [6,]   81   93</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>A.minus.B &lt;-<span class="st"> </span>fruit<span class="op">$</span>A <span class="op">-</span><span class="st"> </span>fruit<span class="op">$</span>B</span>
<span id="cb4-13"><a href="#cb4-13"></a>A.minus.B</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; [1]  -3   2  -7  -6   1 -12</span></span></code></pre></div>
<p>Here are the ranks for these data, without regard to sign.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>abs.fruit.rank &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rank">rank</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(A.minus.B))</span>
<span id="cb5-2"><a href="#cb5-2"></a>abs.fruit.rank</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; [1] 3 2 5 4 1 6</span></span></code></pre></div>
<p>Now let’s attach signs to them.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>fruit.rank &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sign">sign</a></span>(A.minus.B)<span class="op">*</span>abs.fruit.rank</span>
<span id="cb6-2"><a href="#cb6-2"></a>fruit.rank</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt; [1] -3  2 -5 -4  1 -6</span></span></code></pre></div>
<p>Our test statistic is the sum of positive ranks.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>test.statistic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(fruit.rank[fruit.rank <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>])</span>
<span id="cb7-2"><a href="#cb7-2"></a>test.statistic</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Let’s look at the distrbution of the test statistic when the null hypothesis is true. Notice that we are doing just what we did for the Fisher-Pitman test, but this time we are using ranks instead of the original scores.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="../reference/rand_dist.html">rand_dist</a></span>(fruit.rank)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt;       T                               </span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt;  [1,] 0  0.0156250 0.0156250 1.0000000</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt;  [2,] 1  0.0156250 0.0312500 0.9843750</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt;  [3,] 2  0.0156250 0.0468750 0.9687500</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt;  [4,] 3  0.0156250 0.0625000 0.9531250</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt;  [5,] 3  0.0156250 0.0781250 0.9375000</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt;  [6,] 4  0.0156250 0.0937500 0.9218750</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt;  [7,] 4  0.0156250 0.1093750 0.9062500</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;  [8,] 5  0.0156250 0.1250000 0.8906250</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt;  [9,] 5  0.0156250 0.1406250 0.8750000</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt; [10,] 5  0.0156250 0.1562500 0.8593750</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; [11,] 6  0.0156250 0.1718750 0.8437500</span></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co">#&gt; [12,] 6  0.0156250 0.1875000 0.8281250</span></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co">#&gt; [13,] 6  0.0156250 0.2031250 0.8125000</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="co">#&gt; [14,] 6  0.0156250 0.2187500 0.7968750</span></span>
<span id="cb8-17"><a href="#cb8-17"></a><span class="co">#&gt; [15,] 7  0.0156250 0.2343750 0.7812500</span></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co">#&gt; [16,] 7  0.0156250 0.2500000 0.7656250</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co">#&gt; [17,] 7  0.0156250 0.2656250 0.7500000</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="co">#&gt; [18,] 7  0.0156250 0.2812500 0.7343750</span></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co">#&gt; [19,] 8  0.0156250 0.2968750 0.7187500</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co">#&gt; [20,] 8  0.0156250 0.3125000 0.7031250</span></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co">#&gt; [21,] 8  0.0156250 0.3281250 0.6875000</span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="co">#&gt; [22,] 8  0.0156250 0.3437500 0.6718750</span></span>
<span id="cb8-25"><a href="#cb8-25"></a><span class="co">#&gt; [23,] 9  0.0156250 0.3593750 0.6562500</span></span>
<span id="cb8-26"><a href="#cb8-26"></a><span class="co">#&gt; [24,] 9  0.0156250 0.3750000 0.6406250</span></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co">#&gt; [25,] 9  0.0156250 0.3906250 0.6250000</span></span>
<span id="cb8-28"><a href="#cb8-28"></a><span class="co">#&gt; [26,] 9  0.0156250 0.4062500 0.6093750</span></span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="co">#&gt; [27,] 9  0.0156250 0.4218750 0.5937500</span></span>
<span id="cb8-30"><a href="#cb8-30"></a><span class="co">#&gt; [28,] 10 0.0156250 0.4375000 0.5781250</span></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="co">#&gt; [29,] 10 0.0156250 0.4531250 0.5625000</span></span>
<span id="cb8-32"><a href="#cb8-32"></a><span class="co">#&gt; [30,] 10 0.0156250 0.4687500 0.5468750</span></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="co">#&gt; [31,] 10 0.0156250 0.4843750 0.5312500</span></span>
<span id="cb8-34"><a href="#cb8-34"></a><span class="co">#&gt; [32,] 10 0.0156250 0.5000000 0.5156250</span></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co">#&gt; [33,] 11 0.0156250 0.5156250 0.5000000</span></span>
<span id="cb8-36"><a href="#cb8-36"></a><span class="co">#&gt; [34,] 11 0.0156250 0.5312500 0.4843750</span></span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="co">#&gt; [35,] 11 0.0156250 0.5468750 0.4687500</span></span>
<span id="cb8-38"><a href="#cb8-38"></a><span class="co">#&gt; [36,] 11 0.0156250 0.5625000 0.4531250</span></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="co">#&gt; [37,] 11 0.0156250 0.5781250 0.4375000</span></span>
<span id="cb8-40"><a href="#cb8-40"></a><span class="co">#&gt; [38,] 12 0.0156250 0.5937500 0.4218750</span></span>
<span id="cb8-41"><a href="#cb8-41"></a><span class="co">#&gt; [39,] 12 0.0156250 0.6093750 0.4062500</span></span>
<span id="cb8-42"><a href="#cb8-42"></a><span class="co">#&gt; [40,] 12 0.0156250 0.6250000 0.3906250</span></span>
<span id="cb8-43"><a href="#cb8-43"></a><span class="co">#&gt; [41,] 12 0.0156250 0.6406250 0.3750000</span></span>
<span id="cb8-44"><a href="#cb8-44"></a><span class="co">#&gt; [42,] 12 0.0156250 0.6562500 0.3593750</span></span>
<span id="cb8-45"><a href="#cb8-45"></a><span class="co">#&gt; [43,] 13 0.0156250 0.6718750 0.3437500</span></span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="co">#&gt; [44,] 13 0.0156250 0.6875000 0.3281250</span></span>
<span id="cb8-47"><a href="#cb8-47"></a><span class="co">#&gt; [45,] 13 0.0156250 0.7031250 0.3125000</span></span>
<span id="cb8-48"><a href="#cb8-48"></a><span class="co">#&gt; [46,] 13 0.0156250 0.7187500 0.2968750</span></span>
<span id="cb8-49"><a href="#cb8-49"></a><span class="co">#&gt; [47,] 14 0.0156250 0.7343750 0.2812500</span></span>
<span id="cb8-50"><a href="#cb8-50"></a><span class="co">#&gt; [48,] 14 0.0156250 0.7500000 0.2656250</span></span>
<span id="cb8-51"><a href="#cb8-51"></a><span class="co">#&gt; [49,] 14 0.0156250 0.7656250 0.2500000</span></span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="co">#&gt; [50,] 14 0.0156250 0.7812500 0.2343750</span></span>
<span id="cb8-53"><a href="#cb8-53"></a><span class="co">#&gt; [51,] 15 0.0156250 0.7968750 0.2187500</span></span>
<span id="cb8-54"><a href="#cb8-54"></a><span class="co">#&gt; [52,] 15 0.0156250 0.8125000 0.2031250</span></span>
<span id="cb8-55"><a href="#cb8-55"></a><span class="co">#&gt; [53,] 15 0.0156250 0.8281250 0.1875000</span></span>
<span id="cb8-56"><a href="#cb8-56"></a><span class="co">#&gt; [54,] 15 0.0156250 0.8437500 0.1718750</span></span>
<span id="cb8-57"><a href="#cb8-57"></a><span class="co">#&gt; [55,] 16 0.0156250 0.8593750 0.1562500</span></span>
<span id="cb8-58"><a href="#cb8-58"></a><span class="co">#&gt; [56,] 16 0.0156250 0.8750000 0.1406250</span></span>
<span id="cb8-59"><a href="#cb8-59"></a><span class="co">#&gt; [57,] 16 0.0156250 0.8906250 0.1250000</span></span>
<span id="cb8-60"><a href="#cb8-60"></a><span class="co">#&gt; [58,] 17 0.0156250 0.9062500 0.1093750</span></span>
<span id="cb8-61"><a href="#cb8-61"></a><span class="co">#&gt; [59,] 17 0.0156250 0.9218750 0.0937500</span></span>
<span id="cb8-62"><a href="#cb8-62"></a><span class="co">#&gt; [60,] 18 0.0156250 0.9375000 0.0781250</span></span>
<span id="cb8-63"><a href="#cb8-63"></a><span class="co">#&gt; [61,] 18 0.0156250 0.9531250 0.0625000</span></span>
<span id="cb8-64"><a href="#cb8-64"></a><span class="co">#&gt; [62,] 19 0.0156250 0.9687500 0.0468750</span></span>
<span id="cb8-65"><a href="#cb8-65"></a><span class="co">#&gt; [63,] 20 0.0156250 0.9843750 0.0312500</span></span>
<span id="cb8-66"><a href="#cb8-66"></a><span class="co">#&gt; [64,] 21 0.0156250 1.0000000 0.0156250</span></span></code></pre></div>
<p>Let’s clean up the table a bit by combining redundant values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="../reference/rand_dist.html">rand_dist</a></span>(fruit.rank, <span class="dt">show.all =</span> <span class="ot">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#&gt;       T                               </span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt;  [1,] 0  0.0156250 0.0156250 1.0000000</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;  [2,] 1  0.0156250 0.0312500 0.9843750</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;  [3,] 2  0.0156250 0.0468750 0.9687500</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;  [4,] 3  0.0312500 0.0781250 0.9531250</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt;  [5,] 4  0.0312500 0.1093750 0.9218750</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;  [6,] 5  0.0468750 0.1562500 0.8906250</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt;  [7,] 6  0.0625000 0.2187500 0.8437500</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt;  [8,] 7  0.0625000 0.2812500 0.7812500</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt;  [9,] 8  0.0625000 0.3437500 0.7187500</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; [10,] 9  0.0781250 0.4218750 0.6562500</span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt; [11,] 10 0.0781250 0.5000000 0.5781250</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt; [12,] 11 0.0781250 0.5781250 0.5000000</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; [13,] 12 0.0781250 0.6562500 0.4218750</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt; [14,] 13 0.0625000 0.7187500 0.3437500</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt; [15,] 14 0.0625000 0.7812500 0.2812500</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt; [16,] 15 0.0625000 0.8437500 0.2187500</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt; [17,] 16 0.0468750 0.8906250 0.1562500</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt; [18,] 17 0.0312500 0.9218750 0.1093750</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt; [19,] 18 0.0312500 0.9531250 0.0781250</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt; [20,] 19 0.0156250 0.9687500 0.0468750</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt; [21,] 20 0.0156250 0.9843750 0.0312500</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt; [22,] 21 0.0156250 1.0000000 0.0156250</span></span></code></pre></div>
<p>As we would expect, the highest probability under the null hypothesis is smack in the middle of the distribution: 10 and 11. We observed a value of 3. If we use a maximum Type I error rate of 0.10 (a confidence level of 90%), we are unable to reject this null hypothesis in favor of this alternative hypothesis.</p>
<p><span class="math inline">\(H_0: \theta_d = 0\)</span></p>
<p><span class="math inline">\(H_a: \theta_d \ne 0\)</span></p>
<p>If we had been conducting a confirmatory test that Fertilizer B included improvements that we expected would make it more effective, we would use these hypotheses.</p>
<p><span class="math inline">\(H_0: \theta_d = 0\)</span></p>
<p><span class="math inline">\(H_a: \theta_d &lt; 0\)</span></p>
<p>In this case, with a maximum Type I error rate of 0.10, we would be able to reject the null hypothesis in favor of the alternative hypothesis. Note that the direction of the alternative hypothesis is determined by the direction of subtraction in order to obtain our difference scores.</p>
<p>So what advantage have we gained by using ranks instead of the observed differences? There are several, but we will discuss one of these right now and hold off on the others for later discussion. Recall our 3.6 year wait for obtaining the distribution when we have 50 paired differences? Using the Wilcoxon signed rank test, we only have to do that once. Why? Because everytime we have 50 paired differences, the ranks will be the same. So one 3.6 year wait is all that we need to compute the distribution of the test statistic that can then be used for all time. We might envision running a bunch of computers for several years, using different sample sizes, and then publishing these distributions. In fact, that’s been done! You and I don’t have to wait.</p>
<p>We have a function in R that can do the Wilcoxon test for us, so let’s use it. Note that we don’t have to convert to ranks first because it will do that for us.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/wilcox.test">wilcox.test</a></span>(A.minus.B)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="co">#&gt; </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;  Wilcoxon signed rank test</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; </span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; data:  A.minus.B</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; V = 3, p-value = 0.1563</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt; alternative hypothesis: true location is not equal to 0</span></span></code></pre></div>
<p>The <em>p</em> value is what we obtained above. Yay!</p>
<p>We can also provide the observations from the separate fruit trees, but be careful. There is also a Wilcoxon test for two independent samples and that’s not what we want here. We need to specify that we want a paired test. When you enter two sets of observations, the default is a two-sample test calculation.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/wilcox.test">wilcox.test</a></span>(fruit<span class="op">$</span>A, fruit<span class="op">$</span>B, <span class="dt">paired =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">#&gt; </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">#&gt;  Wilcoxon signed rank test</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt; </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; data:  fruit$A and fruit$B</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; V = 3, p-value = 0.1563</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; alternative hypothesis: true location shift is not equal to 0</span></span></code></pre></div>
<p>We can, of course, use this for a one-sided test.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/wilcox.test">wilcox.test</a></span>(fruit<span class="op">$</span>A, fruit<span class="op">$</span>B, <span class="dt">paired =</span> <span class="ot">TRUE</span>, <span class="dt">alternative =</span> <span class="st">"less"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">#&gt; </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt;  Wilcoxon signed rank test</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt; data:  fruit$A and fruit$B</span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt; V = 3, p-value = 0.07813</span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; alternative hypothesis: true location shift is less than 0</span></span></code></pre></div>
<p>What about if we use very large sample sizes? In that case, the function will switch to an approximation. (We will discuss large-sample approximations later.) It uses 50 as the cut-off. Up to 50, it will use an exact test. For 50 and over, it will use an approximation. We can force an exact test in these larger sample settings, but will it work? Let’s try it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Obtain 60 observations from trees with Fertilizer A. I'm going to assume that </span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># these observations are normally distributed.</span></span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>large.A &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">60</span>, <span class="dt">mean =</span> <span class="dv">80</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co"># Do it again for Fertilizer B. I'm going to assume that we obtain an average </span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co"># of 3 more bushels of fruit from this tree.</span></span>
<span id="cb13-8"><a href="#cb13-8"></a></span>
<span id="cb13-9"><a href="#cb13-9"></a>large.B &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">rnorm</a></span>(<span class="dv">60</span>, <span class="dt">mean =</span> <span class="dv">83</span>, <span class="dt">sd =</span> <span class="dv">10</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co"># Let's suppose we are doing confirmatory research, so we'll do a one-sided </span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co"># test. Now we hold our breath and hope that we aren't holding it for 400 </span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co"># years.</span></span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/wilcox.test">wilcox.test</a></span>(large.A, large.B, <span class="dt">paired =</span> <span class="ot">TRUE</span>, <span class="dt">alternative =</span> <span class="st">"less"</span>, <span class="dt">exact =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt; </span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt;  Wilcoxon signed rank test</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt; </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; data:  large.A and large.B</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt; V = 505, p-value = 0.00109</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; alternative hypothesis: true location shift is less than 0</span></span></code></pre></div>
<p>Wow! It did it, and fast! Let’s see how this compares to if we had just let the function do the large-sample approximation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/wilcox.test">wilcox.test</a></span>(large.A, large.B, <span class="dt">paired =</span> <span class="ot">TRUE</span>, <span class="dt">alternative =</span> <span class="st">"less"</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">#&gt; </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">#&gt;  Wilcoxon signed rank test with continuity correction</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt; </span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt; data:  large.A and large.B</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; V = 505, p-value = 0.001287</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; alternative hypothesis: true location shift is less than 0</span></span></code></pre></div>
<p>This is quite good, which is why the function switches to the large-sample approximation at 50. We know that the Fisher-Pitman permutation test with original scores would take way too long for us to do in our lifetime. (Maybe grandchildren could get our results off the printer and help establish our lebacy!) Yet we also know that the <em>t</em> test is a large-sample approxiamation for the Fisher-Pitman permutation test, so let’s see how those results compare.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/t.test">t.test</a></span>(large.A, large.B, <span class="dt">paired =</span> <span class="ot">TRUE</span>, <span class="dt">alternative =</span> <span class="st">"less"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt;  Paired t-test</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; data:  large.A and large.B</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt; t = -3.0469, df = 59, p-value = 0.001728</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; alternative hypothesis: true difference in means is less than 0</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt;       -Inf -2.726748</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt; sample estimates:</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; mean of the differences </span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt;               -6.038705</span></span></code></pre></div>
<p>Remember that we simulated this study using random numbers, so your results will be different than mine, and my results will be different every time I go through this vignette. What we do know is that <em>most of the time</em> we should obtain a smaller <em>p</em> value with the <em>t</em> test. Why? Because we have exactly met the conditions for valid inference with the <em>t</em> test by simulating our data using a normal distribution. I will venture, however, that most of the time when you try this that your results will not differ too drastically from what you are obtaining with the Wilcoxon test.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael Seaman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
